<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Dialer</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Dialer Screen -->
        <div class="dialer" id="dialerScreen">
            <div class="display">
                <input type="text" id="codeDisplay" class="code-input" placeholder="Enter code" readonly>
            </div>
            
            <div class="keypad">
                <button class="key" data-number="1">1</button>
                <button class="key" data-number="2">2</button>
                <button class="key" data-number="3">3</button>
                <button class="key" data-number="4">4</button>
                <button class="key" data-number="5">5</button>
                <button class="key" data-number="6">6</button>
                <button class="key" data-number="7">7</button>
                <button class="key" data-number="8">8</button>
                <button class="key" data-number="9">9</button>
                <button class="key" data-number="*">*</button>
                <button class="key" data-number="0">0</button>
                <button class="key" data-number="#">#</button>
            </div>
            
            <div class="controls">
                <button id="clearBtn" class="control-btn clear">Clear</button>
                <button id="callBtn" class="control-btn call">Call</button>
            </div>
        </div>

        <!-- Active Call Screen -->
        <div class="call-screen" id="callScreen" style="display: none;">
            <div class="call-info">
                <div class="call-status">Call Active</div>
                <div class="call-duration" id="callDuration">00:00</div>
            </div>
            
            <div class="call-controls">
                <button id="endCallBtn" class="control-btn end-call">End Call</button>
            </div>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        const codeDisplay = document.getElementById('codeDisplay');
        const keyButtons = document.querySelectorAll('.key');
        const clearBtn = document.getElementById('clearBtn');
        const callBtn = document.getElementById('callBtn');
        const audioPlayer = document.getElementById('audioPlayer');
        const dialerScreen = document.getElementById('dialerScreen');
        const callScreen = document.getElementById('callScreen');
        const endCallBtn = document.getElementById('endCallBtn');
        const callDuration = document.getElementById('callDuration');
        
        let enteredCode = '';
        let callStartTime = null;
        let callTimerInterval = null;

        // Handle number button clicks
        keyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const number = button.getAttribute('data-number');
                enteredCode += number;
                codeDisplay.value = enteredCode;
                playTone(number);
            });
        });

        // Clear button
        clearBtn.addEventListener('click', () => {
            enteredCode = '';
            codeDisplay.value = '';
        });

        // Call button - plays audio file based on entered code
        callBtn.addEventListener('click', () => {
            if (enteredCode) {
                startCall(enteredCode);
            } else {
                alert('Please enter a code first');
            }
        });

        // End call button
        endCallBtn.addEventListener('click', () => {
            endCall();
        });

        // Play tone when button is pressed
        function playTone(number) {
            console.log('Button pressed: ' + number);
        }

        // Start call
        function startCall(code) {
            const audioPath = `audio/${code}.mp3`;
            console.log('Attempting to play:', audioPath);
            
            audioPlayer.src = audioPath;
            audioPlayer.volume = 1;
            
            audioPlayer.onerror = (error) => {
                console.error('Audio error:', error);
                console.error('Failed to load:', audioPath);
                alert('Could not find audio file: ' + audioPath);
            };
            
            const playPromise = audioPlayer.play();
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('Playback started successfully');
                        // Switch to call screen
                        dialerScreen.style.display = 'none';
                        callScreen.style.display = 'flex';
                        
                        // Start timer
                        callStartTime = Date.now();
                        startCallTimer();
                    })
                    .catch(error => {
                        console.error('Playback failed:', error);
                    });
            }
        }

        // Start call duration timer
        function startCallTimer() {
            callTimerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                callDuration.textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        // End call
        function endCall() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            
            // Stop timer
            if (callTimerInterval) {
                clearInterval(callTimerInterval);
                callTimerInterval = null;
            }
            
            // Reset call info
            callDuration.textContent = '00:00';
            enteredCode = '';
            codeDisplay.value = '';
            
            // Switch back to dialer screen
            callScreen.style.display = 'none';
            dialerScreen.style.display = 'block';
        }
    </script>
</body>
</html>